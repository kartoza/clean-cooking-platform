{% extends 'eae_base.html' %}
{% load staticfiles %}

{% block extra_head %}
    <link href="{% static "halfmoon-1.1.1/css/halfmoon.min.css" %}"
          rel="stylesheet">
    <link href="{% static "halfmoon-1.1.1/css/halfmoon-variables.min.css" %}"
          rel="stylesheet">
    <link href="{% static "css/loading.css" %}" rel="stylesheet"/>
    <link href="{% static "fontawesome/css/all.min.css" %}" rel="stylesheet">
    <link href="{% static "css/breadcrumb.css" %}" rel="stylesheet"/>
    <link href="{% static "css/cca-buttons.css" %}" rel="stylesheet"/>
    <script src="{% static "chartjs-3.5.1/chart.min.js" %}"></script>

    <link href="https://api.mapbox.com/mapbox-gl-js/v2.5.0/mapbox-gl.css"
          rel="stylesheet">
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.5.0/mapbox-gl.js"></script>
    <script src='https://api.mapbox.com/mapbox.js/plugins/turf/v2.0.2/turf.min.js'></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>

    <script>
        let MAPBOX_THEME = '';
        let MAPBOX_TOKEN = '';
    </script>

    <script src="{% static "eae/lib/browsers.js" %}"></script>
    <script src="{% static "eae/tool/browser.js" %}"></script>

    <script src="{% static "eae/tool/libs.js" %}"></script>
    <script src="{% static "geotiff.js" %}" type="text/javascript"></script>
    <script src="{% static "sldStyleParser.js" %}"></script>
    <script src="{% static "mapboxStyleParser.js" %}"></script>
    <script src="{% static "eae/tool/main.js" %}"></script>
    <script src="{% static "eae/lib/helpers.js" %}"></script>

    <script>
        let parser = new GeoStylerSLDParser.SldStyleParser();
        let mapboxParser = new GeoStylerMapboxParser.MapboxStyleParser();
        let url = new URL(window.location.href);
        let boundary = url.searchParams.get('boundary');
        let geoId = url.searchParams.get('geoId');
        let subRegion = '{{ subRegion.1 }}';
        let useCaseId = '{{ use_case.id }}';
        mapboxgl.accessToken = '{{ MAPBOX_TOKEN }}';
        let mapboxStyle = 'mapbox://styles/{{ MAPBOX_THEME }}';
        let allLayerIds = {{ all_layer_ids }};
        let csrfToken = '{{ csrf_token }}';
        let geojsonBoundary = `/uploaded/rasterized/${boundary}.json`;
        let rasterBoundary = `/uploaded/rasterized/${boundary}.tif`;
        let bbox = null;
        let coords = [];

        GEOGRAPHY = null;
        MAPBOX = null;
        INFOMODE = false;
        MOBILE = false;
        SIDEBAR = null;
        O = null;
        U = null;
        DST = new Map();
    </script>

    <link rel="stylesheet" href="{% static "ol-6.8.1/ol.css" %}">
    <style>
        .sub-title {
            padding: 1em;
            color: white;
            font-size: 18px;
            font-weight: bold;
        }

        .sub-title-1 {
            background: #579d44;
        }

        .sub-title-2 {
            background: #4a883f;
        }

        .card {
            margin: 0;
            margin-top: 1rem;
        }

        .btn-scene {
            width: 100%;
            padding-bottom: 0.5em;
            padding-top: 0.5em;
            height: 100%;
            justify-content: center;
        }

        .dropdown-menu-center {
            font-size: 15px
        }

        .map {
            margin-top: 20px;
            border-radius: 5px;
            width: 100%;
            height: 500px;
        }

        .ol-viewport {
            border-radius: 20px;
        }

        #canvas-output-select {
            display: none;
        }

        #output {
            display: none;
        }

        .loading-spinner-container {
            position: absolute;
            left: 0;
            margin-left: 10px;
            height: 100%;
            margin-top: -0.4em;
        }
    </style>
{% endblock %}

{% block content %}
    <div class="container">
        <div style="height: 20px;"></div>

         <div class="container">
             <div class="breadcrumb">
                 <a href="#">
                <span class="active breadcrumb__inner">
                    <span class="breadcrumb__title">Geography</span>
                    <span class="breadcrumb__desc"> {{ subRegion.1 }}, {{ geo.name }}</span>
                </span>
                 </a>
                 <a href="#">
                <span class="breadcrumb__inner">
                    <span class="breadcrumb__title">Use Case</span>
                    <span class="breadcrumb__desc">{{ use_case.name }}</span>
                </span>
                 </a>
                 <a href="#"  class="active">
                <span class="breadcrumb__inner">
                    <span class="breadcrumb__title">Tool</span>
                    <span class="breadcrumb__desc">CCE Tool</span>
                </span>
                 </a>
             </div>
         </div>


        <div class="card" style="text-align: center">
            <h4 class="h4 blue-text title-text card-title">
                Clean Cooking Explorer Tool
            </h4>
            <p>
                CCE is a dimensional analysis, ranking areas where demand or
                potential is high. <a href="/methodology"
                                      class="btn btn-secondary" type="button">Find
                out more</a>
            </p>

            <!-- Dropdown menu aligned to the center -->
            <select class="form-control" id="scenarioSelect"
                    style="width: 100%; height: 60px; margin-left: auto; margin-right: auto">
                <option value="" selected="selected" disabled="disabled">Choose
                    a
                    scenario
                </option>
                {% for preset in presets %}
                    <option value="{{ preset.id }}"
                            data-url="{{ preset.permalink }}" data-layers="{{ preset.layers }}">{{ preset.name }}</option>
                {% endfor %}
            </select>
            <div class="row" style="margin-top: 2em">
                <div class="col-lg-6">
                    <button class="btn btn-scene btn-cca-primary"
                            id="report-btn" disabled>
                        <div style="position: absolute; display: none" id="loading-spinner-0" class="loading-spinner-container"><div class="loading-spinner"><div></div></div></div> Clean Cooking Access Report
                    </button>
                </div>
                <div class="col-lg-6">
                    <button class="btn btn-scene" id="cca-tool-btn" disabled>
                        <div style="position: absolute; display: none" id="loading-spinner-1" class="loading-spinner-container"><div class="loading-spinner"><div></div></div></div> Clean Cooking Explorer Tool
                    </button>
                </div>
            </div>
            <div class="spacer" style="height: 10px"></div>
        </div>
        <div id="map" class="map" style="margin-bottom: 20px;"></div>

        <div id="cards-pane">
          <div id="cards-list"></div>
        </div>

        <div id="indexes-pane">
            <div id="index-graphs">
                <div id="index-graphs-title" class="up-title"></div>
                <div id="index-graphs-toolbox">
                    <a id="index-graphs-info"
                       title="Info about different indexes"></a>
                    <a id="index-graphs-download"
                       title="Download TIFF image of the current analysis"></a>
                    <a id="index-graphs-code"
                       title="Download JSON file of the current analysis"></a>
                </div>
                <div id="index-graphs-description"></div>
            </div>

            <ul id="indexes-list"></ul>
            <div id="population-number"></div>
            <div id="area-number"></div>
        </div>

        <template id="svg-list">
            <svg width="24" height="24" viewBox="0 0 24 24">
                <path d="M3,4H7V8H3V4M9,5V7H21V5H9M3,10H7V14H3V10M9,11V13H21V11H9M3,16H7V20H3V16M9,17V19H21V17H9"/>
            </svg>
        </template>

        <template id="svg-map">
            <svg width="24" height="24" viewBox="0 0 24 24">
                <path d="M9,3L3.36,4.9C3.15,4.97 3,5.15 3,5.38V20.5A0.5,0.5 0 0,0 3.5,21L3.66,20.97L9,18.9L15,21L20.64,19.1C20.85,19.03 21,18.85 21,18.62V3.5A0.5,0.5 0 0,0 20.5,3L20.34,3.03L15,5.1L9,3M8,5.45V17.15L5,18.31V6.46L8,5.45M10,5.47L14,6.87V18.53L10,17.13V5.47M19,5.7V17.54L16,18.55V6.86L19,5.7M7.46,6.3L5.57,6.97V9.12L7.46,8.45V6.3M7.46,9.05L5.57,9.72V11.87L7.46,11.2V9.05M7.46,11.8L5.57,12.47V14.62L7.46,13.95V11.8M7.46,14.55L5.57,15.22V17.37L7.46,16.7V14.55Z"/>
            </svg>
        </template>

        <template id="svg-pie">
            <svg width="24" height="24" viewBox="0 0 24 24">
                <path d="M11,2V22C5.9,21.5 2,17.2 2,12C2,6.8 5.9,2.5 11,2M13,2V11H22C21.5,6.2 17.8,2.5 13,2M13,13V22C17.7,21.5 21.5,17.8 22,13H13Z"/>
            </svg>
        </template>

        <template id="bottom-right-container-output-template">
            <div id="bottom-right-container-output"
                 class="bottom-right-container">
                <select id="canvas-output-select"></select>
                <canvas id="output"></canvas>
            </div>
        </template>

        <div>
            <canvas id="ani-output" style="display: none;"></canvas>
        </div>
        <div>
            <canvas id="eai-output" style="display: none"></canvas>
        </div>
        <div>
            <canvas id="supply-output" style="display: none"></canvas>
        </div>
        <div>
            <canvas id="demand-output" style="display: none"></canvas>
        </div>

        <canvas id="output"></canvas>
    </div>
{% endblock %}

{% block footer_js %}
    <script src="{% static "halfmoon-1.1.1/js/halfmoon.min.js" %}"
            type="text/javascript"></script>


    <script type="module">
        import {init, getDatasets} from '/static/eae/tool/summary_report.js';
        init();
        window.getDatasets = getDatasets;
    </script>

    <script src="{% static "js/report.js" %}" type="text/javascript"></script>

    <script src="{% static "js/mapbox-helper/plot.js" %}" type="text/javascript"></script>
    <script src="{% static "js/mapbox-helper/style.js" %}" type="text/javascript"></script>

{% endblock %}